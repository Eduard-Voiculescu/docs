---
title: Mise à niveau d'un subgraph existant vers le réseau Graph
---

## Présentation

Ceci est un guide sur la façon de mettre à niveau votre subgraph du service hébergé vers le réseau décentralisé de The Graph. Plus de 1 000 sous-graphiques ont été mis à niveau avec succès vers The Graph Network, y compris des projets tels que Snapshot, Loopring, Audius, Premia, Livepeer, Uma, Curve, Lido et bien d'autres !

Le processus de mise à niveau est rapide et vos subgraphs bénéficieront à jamais de la fiabilité et de la performance que vous ne pouvez obtenir que sur le Réseau Graph.

### Conditions préalables

- You have a subgraph deployed on the hosted service.

## Mise à niveau d'un subgraph existant vers le réseau Graph

<VideoEmbed youtube="hCmX5Dlhdjw" />

If you are logged in to the hosted service, you can access a simple flow to upgrade your subgraphs from [your dashboard](https://thegraph.com/hosted-service/dashboard), or from an individual subgraph page.

> This process typically takes less than five minutes.

1. Select the subgraph(s) you want to upgrade.
2. Connect or enter the receiving wallet (the wallet that will become the owner of the subgraph).
3. Click the "Upgrade" button.

That's it! Your subgraphs will be deployed to Subgraph Studio, and published on The Graph Network. You can access the [Subgraph Studio](thegraph.com/studio) to manage your subgraphs, logging in with the wallet specified during the upgrade process.

You'll be able to view your subgraphs live on the decentralized network via [Graph Explorer](https://thegraph.com/explorer).

### What next?

When your subgraph is upgraded, it will automatically be indexed by the upgrade indexer. If the indexed chain is [fully supported by The Graph Network](/developing/supported-networks), you can add some GRT as "signal", to attract more indexers. It is recommended to curate your subgraph with at least 3,000 GRT to attract 2-3 Indexers for higher quality of service.

You can start to query your subgraph right away on The Graph Network, once you have generated an API key.

### Créer une clé d'API

Vous pouvez générer une clé API dans Subgraph Studio [Ici](https://thegraph.com/studio/apikeys/).

![Page de création de la clé API](/img/api-image.png)

You can use this API key to query subgraphs on The Graph Network. All users start on the Free Plan, which includes 100,000 free queries per month. Developers can sign up for the Growth Plan by connecting a credit or debit card, or by depositing GRT to Subgraph Studio billing system.

> Note: see the [billing documentation](../billing) for more information on plans, and on managing your billing on Subgraph Studio.

### Sécurisation de votre clé API

Il est recommandé de sécuriser l'API en limitant son utilisation de deux manières :

1. Les subgraphs autorisés
2. Le Domaine autorisé

Vous pouvez sécuriser votre clé API [ici](https://thegraph.com/studio/apikeys/test/).

![Page de verrouillage du subgraph](/img/subgraph-lockdown.png)

### Interroger votre subgraph sur le réseau décentralisé

Vous pouvez maintenant vérifier l'état d'indexation des indexeurs sur le réseau dans Graph Explorer (exemple [here](https://thegraph.com/explorer/subgraph? id=S9ihna8D733WTEShJ1KctSTCvY1VJ7gdVwhUujq4Ejo&view=Indexers)). The Également dans l'onglet Indexeur, vous pouvez voir quels indexeurs ont récupéré votre subgraph.

![Subgraph Rocket Pool](/img/rocket-pool-subgraph.png)

Dès que le premier indexeur a complètement indexé votre subgraph, vous pouvez commencer à interroger le subgraph sur le réseau décentralisé. Afin de récupérer l'URL de requête pour votre subgraph, vous pouvez le copier/coller en cliquant sur le symbole à côté de l'URL de requête. Vous verrez quelque chose comme ceci :

`https://gateway.thegraph.com/api/[api-key]/subgraphs/id/S9ihna8D733WTEShJ1KctSTCvY1VJ7gdVwhUujq4Ejo`

Important : Assurez-vous de remplacer `[api-key]` par une clé API réelle générée dans la section ci-dessus.

Vous pouvez maintenant utiliser cette URL de requête dans votre dapp pour envoyer vos requêtes GraphQL.

Toutes nos félicitations! Vous êtes désormais un pionnier de la décentralisation !

> Notez : En raison de la nature distribuée du réseau, il se peut que différents indexeurs aient indexé des blocs différents. Afin de ne recevoir que des données fraîches, vous pouvez spécifier le bloc minimum qu'un indexeur doit avoir indexé pour servir votre requête avec l'argument de champ block : `{ number_gte: $minBlock }` comme le montre l'exemple ci-dessous :

```graphql
{
  stakers(block : { number_gte : 14486109 }) {
    id
  }
}
```

Plus d'informations sur la nature du réseau et sur la manière de gérer les réorganisations sont décrites dans l'article de documentation [Distributed Systems](/querying/distributed-systems/).

## Mise à jour d'un subgraph sur le réseau

If you would like to update an existing subgraph on the network, you can do this by deploying a new version of your subgraph to Subgraph Studio using the Graph CLI.

1. Make changes to your current subgraph.
2. Déployez les éléments suivants et spécifiez la nouvelle version dans la commande (par exemple v0.0.1, v0.0.2, etc.) :

```sh
graph deploy --studio --version <version> <SUBGRAPH_SLUG>
```

3. Test the new version in Subgraph Studio by querying in the playground
4. Publier la nouvelle version sur le réseau graph. N'oubliez pas que cela nécessite du gaz (comme décrit dans la section ci-dessus).

### Owner Update Fee: Deep Dive

> Note: Curation on Arbitrum has a flat bonding curve. Learn more about Arbitrum [here](/arbitrum/arbitrum-faq/).

Une mise à jour nécessite que des GRT soient migré de l'ancienne version du subgraph vers la nouvelle version. Cela signifie que pour chaque mise à jour, une nouvelle courbe de liaison sera créée (plus d'informations sur les courbes de liaison [here](/network/curating#bonding-curve-101)).

Les nouveaux frais de la coube liaison applique la taxe de curation de 1 % sur tous les GRT transférés vers la nouvelle version. Le propriétaire doit payer 50 % de cette taxe, soit 1,25 %. L'autre 1,25 % est absorbé par tous les conservateurs en tant que frais. Ce système d'incitation a été mis en place pour empêcher le propriétaire d'un subgraph de drainer tous les fonds de son curateur par des appels récursifs de mise à jour. S'il n'y a pas d'activité de curation, vous devrez payer un minimum de 100 GRT pour signaler votre propre subgraph.

Prenons un exemple, ce n'est le cas que si votre subgraph fait l'objet d'une curation active :

- 100,000 GRT sont signalés en utilisant la migration automatique sur la v1 d'un subgraph
- Le propriétaire passe à la version 2. 100 000 GRT sont transférés vers une nouvelle courbe de collage, où 97 500 GRT sont placés dans la nouvelle courbe et 2 500 GRT sont brûlés
- Le propriétaire fait alors brûler 1 250 GRT pour payer la moitié des frais. Le propriétaire doit l'avoir dans son portefeuille avant la mise à jour, sinon la mise à jour échouera. Cela se produit dans la même transaction que la mise à jour.

_Bien que ce mécanisme soit actuellement actif sur le réseau, la communauté discute actuellement des moyens de réduire le coût des mises à jour pour les développeurs de subgraphs._

### Maintenir une version stable d'un subgraph

Si vous apportez de nombreuses modifications à votre subgraph, il n'est pas judicieux de le mettre à jour en permanence et de faire face aux coûts de mise à jour. Il est essentiel de maintenir une version stable et cohérente de votre subgraph, non seulement du point de vue des coûts, mais aussi pour que les indexeurs puissent avoir confiance dans leurs temps de synchronisation. Les indexeurs doivent être avertis lorsque vous prévoyez une mise à jour afin que les délais de synchronisation des indexeurs ne soient pas affectés. N'hésitez pas à utiliser le [#Indexers channel](https://discord.gg/JexvtHa7dq) sur Discord pour informer les indexeurs de la mise à jour de vos subgraphs.

Les subgraphs sont des API ouvertes que les développeurs externes exploitent. Les API ouvertes doivent suivre des normes strictes afin de ne pas casser les applications des développeurs externes. Dans The Graph Network, un développeur de subgraphs doit prendre en compte les indexeurs et le temps qu'il leur faut pour synchroniser un nouveau subgraph **ainsi que** les autres développeurs qui utilisent leurs subgraphs.

### Mise à jour des métadonnées d'un subgraph

You can update the metadata of your subgraphs without having to publish a new version. The metadata includes the subgraph name, image, description, website URL, source code URL, and categories. Developers can do this by updating their subgraph details in Subgraph Studio where you can edit all applicable fields.

Assurez-vous que **Mettre à jour les détails du subgraph dans l'Explorateur** est coché et cliquez sur **Enregistrer**. Si cette case est cochée, une transaction en chaîne sera générée qui mettra à jour les détails du subgraph dans l'Explorateur sans avoir à publier une nouvelle version avec un nouveau déploiement.

## Meilleures pratiques pour le déploiement d'un subgraph sur le réseau The Graph

1. Utilisation d'un nom d'ENS pour le développement de subgraph :

- Configurez votre ENS [ici] (https://app.ens.domains/)
- Ajoutez votre nom ENS à vos paramètres [ici] (https://thegraph.com/explorer/settings?view=display-name).

2. Plus vos profils seront complets, plus vos subgraphes auront de chances d'être indexés et conservés.

## Dépréciation d'un subgraph sur le réseau de graph

Suivez les étapes [ici](/managing/deprecating-a-subgraph) pour déprécier votre subgraph et le retirer du réseau The Graph Network.

## Interrogation d'un subgraph + facturation sur le reseau The Graph

Le service hébergé a été configuré pour permettre aux développeurs de déployer leurs subgraphs sans aucune restriction.

On The Graph Network, query fees have to be paid as a core part of the protocol's incentives. For more information on subscribing to APIs and paying the query fees, check out billing documentation [here](/billing/).

## Ressources additionnelles

Si vous êtes encore confus, n'ayez crainte ! Consultez les ressources suivantes ou regardez notre guide vidéo sur la mise à niveau des subgraphs vers le réseau décentralisé ci-dessous :

<VideoEmbed youtube="satdwdbvzAQ" />

- [The Graph Network Contracts](https://github.com/graphprotocol/contracts)
- [Contrat de curation] (https://github.com/graphprotocol/contracts/blob/dev/contracts/curation/Curation.sol) - le contrat sous-jacent autour duquel le GNS s'articule
  - Address - `0x8fe00a685bcb3b2cc296ff6ffeab10aca4ce1538`
- [Documentation sur Subgraph Studio](/deploying/subgraph-studio)
